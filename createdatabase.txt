from . import featureextraction

ObtainPermissionList() 
arr1 = os.listdir("./dataset/malware")
arr2 = os.listdir("./dataset/benign")
datasetFile = open("datasetfile.txt", "a")
groupedFeatures = open("groupedfeatures.txt", "r")
dataBase = open("database.txt", "a")
a = 1

for f in arr1 : 
    permissionVector = Extract("dataset/malware/"+f)
    permissionVector[len(permissionVector)-3] = AppSizeExtract("dataset/malware/"+f+"/res)
    permissionVector[0] = a	
    permissionVector[len(permissionVector)-1] = 1
    datasetFile.write(str(permissionVector[0]))
    for i in range(1,len(permissionVector)):
        datasetFile.write(',' + str(permissionVector[i]) )
    datasetFile.write('\n')
    a++

b = a+1

for f in arr2 : 
    permissionVector = Extract("dataset/benign/"+f)
    permissionVector[len(permissionVector)-3] = AppSizeExtract("dataset/benign/"+f+"/res)
    permissionVector[0] = b	
    permissionVector[len(permissionVector)-1] = 0
    datasetFile.write(str(permissionVector[0]))
    for i in range(1,len(permissionVector)):
        datasetFile.write(',' + str(permissionVector[i]) )
    datasetFile.write('\n')
    b++

groups = [APPLICATION_ID,ACCESS_SUM,BIND_SUM,BROADCAST_SUM,CONTROL_SUM,GET_SUM,MANAGE_SUM,MODIFY_SUM,SET_SUM,UPDATE_SUM,WRITE_SUM,READ_SUM,APPLICATION_SIZE,ICONS,APPLICATION_TYPE]
dataBase.append(groups)
row = len(datasetFile)
col = len(datasetFile[0])
matrix = [[0 for x in range(15)] for y in range(row)]
for i in row :
	for j in col :
		if j==0 or j==398 or j==397 or j==396 :
			matrix[i][j]=datasetFile[i][j]
		else		
			for k in range(11) :
				if PERMISSIONS_LIST[j-1] in groupedFeatures[k] :
					matrix[i][k+1] += datasetFile[i][j]
					break				
dataBase.append(matrix)

datasetFile.close()
groupedFeatures.close()
dataBase.close()